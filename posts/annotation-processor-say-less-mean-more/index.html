<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Annotation processor: Say less, mean more - Coroutinedispatchers&#39; blog</title><meta name="Description" content="About LoveIt Theme"><meta property="og:title" content="Annotation processor: Say less, mean more" />
<meta property="og:description" content="Annotation processor: Say less, mean more * { font-family: Georgia, Cambria, &ldquo;Times New Roman&rdquo;, Times, serif; } html, body { margin: 0; padding: 0; } h1 { font-size: 50px; margin-bottom: 17px; color: #333; } h2 { font-size: 24px; line-height: 1.6; margin: 30px 0 0 0; margin-bottom: 18px; margin-top: 33px; color: #333; } h3 { font-size: 30px; margin: 10px 0 20px 0; color: #333; } header { width: 640px; margin: auto; } section { width: 640px; margin: auto; } section p { margin-bottom: 27px; font-size: 20px; line-height: 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://coroutinedispatcher.github.io/coroutinedispatcher/posts/annotation-processor-say-less-mean-more/" />
<meta property="article:published_time" content="2019-06-19T10:33:00+02:00" />
<meta property="article:modified_time" content="2019-06-19T10:33:00+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Annotation processor: Say less, mean more"/>
<meta name="twitter:description" content="Annotation processor: Say less, mean more * { font-family: Georgia, Cambria, &ldquo;Times New Roman&rdquo;, Times, serif; } html, body { margin: 0; padding: 0; } h1 { font-size: 50px; margin-bottom: 17px; color: #333; } h2 { font-size: 24px; line-height: 1.6; margin: 30px 0 0 0; margin-bottom: 18px; margin-top: 33px; color: #333; } h3 { font-size: 30px; margin: 10px 0 20px 0; color: #333; } header { width: 640px; margin: auto; } section { width: 640px; margin: auto; } section p { margin-bottom: 27px; font-size: 20px; line-height: 1."/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://coroutinedispatcher.github.io/coroutinedispatcher/posts/annotation-processor-say-less-mean-more/" /><link rel="prev" href="https://coroutinedispatcher.github.io/coroutinedispatcher/posts/kotlin-coroutines-non-confusing-one/" /><link rel="next" href="https://coroutinedispatcher.github.io/coroutinedispatcher/posts/usage-of-viewmodelscope/" /><link rel="stylesheet" href="/coroutinedispatcher/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/coroutinedispatcher/css/style.min.css"><link rel="stylesheet" href="/coroutinedispatcher/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/coroutinedispatcher/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Annotation processor: Say less, mean more",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/coroutinedispatcher.github.io\/coroutinedispatcher\/posts\/annotation-processor-say-less-mean-more\/"
        },"genre": "posts","wordcount":  989 ,
        "url": "https:\/\/coroutinedispatcher.github.io\/coroutinedispatcher\/posts\/annotation-processor-say-less-mean-more\/","datePublished": "2019-06-19T10:33:00+02:00","dateModified": "2019-06-19T10:33:00+02:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Stavro Xhardha"},"author": {
                "@type": "Person",
                "name": "Stavro Xhardha"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/coroutinedispatcher/" title="Coroutinedispatchers&#39; blog">Coroutinedispatchers&#39; blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/coroutinedispatcher/"> Home </a><a class="menu-item" href="/coroutinedispatcher/posts/"> Posts </a><a class="menu-item" href="/coroutinedispatcher/about/"> About </a><a class="menu-item" href="https://speakerdeck.com/stavro96" rel="noopener noreffer" target="_blank"> Presentation Slides </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/coroutinedispatcher/" title="Coroutinedispatchers&#39; blog">Coroutinedispatchers&#39; blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/coroutinedispatcher/" title="">Home</a><a class="menu-item" href="/coroutinedispatcher/posts/" title="">Posts</a><a class="menu-item" href="/coroutinedispatcher/about/" title="">About</a><a class="menu-item" href="https://speakerdeck.com/stavro96" title="" rel="noopener noreffer" target="_blank">Presentation Slides</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Annotation processor: Say less, mean more</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/about/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Stavro Xhardha</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2019-06-19">2019-06-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;989 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents"></nav></div>
            </div><div class="content" id="content"><p>Annotation processor: Say less, mean more * { font-family: Georgia, Cambria, &ldquo;Times New Roman&rdquo;, Times, serif; } html, body { margin: 0; padding: 0; } h1 { font-size: 50px; margin-bottom: 17px; color: #333; } h2 { font-size: 24px; line-height: 1.6; margin: 30px 0 0 0; margin-bottom: 18px; margin-top: 33px; color: #333; } h3 { font-size: 30px; margin: 10px 0 20px 0; color: #333; } header { width: 640px; margin: auto; } section { width: 640px; margin: auto; } section p { margin-bottom: 27px; font-size: 20px; line-height: 1.6; color: #333; } section img { max-width: 640px; } footer { padding: 0 20px; margin: 50px 0; text-align: center; font-size: 12px; } .aspectRatioPlaceholder { max-width: auto !important; max-height: auto !important; } .aspectRatioPlaceholder-fill { padding-bottom: 0 !important; } header, section[data-field=subtitle], section[data-field=description] { display: none; }</p>
<p>I’ve always been curious on what is behind an annotation. As much as they made my angry, believe me they are so fun. This is my experience…</p>
<hr>
<p><img
        class="lazyload"
        src="/coroutinedispatcher/svg/loading.min.svg"
        data-src="https://cdn-images-1.medium.com/max/800/1*Jsodd7y2uNxBeWED_ufuHg.jpeg"
        data-srcset="https://cdn-images-1.medium.com/max/800/1*Jsodd7y2uNxBeWED_ufuHg.jpeg, https://cdn-images-1.medium.com/max/800/1*Jsodd7y2uNxBeWED_ufuHg.jpeg 1.5x, https://cdn-images-1.medium.com/max/800/1*Jsodd7y2uNxBeWED_ufuHg.jpeg 2x"
        data-sizes="auto"
        alt="https://cdn-images-1.medium.com/max/800/1*Jsodd7y2uNxBeWED_ufuHg.jpeg"
        title="https://cdn-images-1.medium.com/max/800/1*Jsodd7y2uNxBeWED_ufuHg.jpeg" /></p>
<p>I’ve always been curious on what is behind an annotation. As much as they made my angry, believe me they are so fun. This is my experience as a beginner on the Annotation Processing.</p>
<p>I will give my own definition for an annotation:</p>
<p><em>An annotation is just a way to mark a class, field, another annotation, method etc. Why? It just tells that the marked component has a special attribute. But how do you handle it?</em></p>
<p>The way to handle an <code>Annotation</code> is through generating code at compile time. This has always intrigued me. Why? This depends on the use case. Have you ever thought how <a href="https://github.com/google/dagger" target="_blank" rel="noopener noreffer">Dagger2</a> knows what dependencies you are using? Or perhaps how <a href="https://jakewharton.github.io/butterknife/" target="_blank" rel="noopener noreffer">Butterknife</a> knows how to bind views or set an <code>onClickListener</code>? Yep, generating code at compile time. The process of generating code at compile time to handle the annotations is called <code>Annotation Processing</code> . I will do a simple use case, explaining all what’s happening.</p>
<p><strong>The use case:</strong></p>
<p>I hate to type:</p>
<pre><code>activity.getSupportFragmentManager()  
.beginTransaction()  
.replace(R.id.someId,SomeFragment.newInstance())  
.commit()
</code></pre><p>for each fragment that I need to start. Someone here would be right to say that what do we need the annotations for, but this article is for “academical” reasons, not for providing some best practice or refactor.</p>
<p><strong>Setup:</strong></p>
<p>First of all, you must know that creating an annotation and handling it, you need separated modules. That’s because we need to tell <code>gradle</code> that there is some code that needs to be imported and the other code that works as a compiler. To create a new module in Android Studio go to <em>File-&gt;New-&gt;Module</em> and select Java Library.</p>
<blockquote>
<p>Note, Android Library is not necessary in this case. Choose Android library when you are creating a custom view class or whatever.</p>
</blockquote>
<p>So let’s go :</p>
<p><img
        class="lazyload"
        src="/coroutinedispatcher/svg/loading.min.svg"
        data-src="https://cdn-images-1.medium.com/max/800/1*CZm2Gzk1ChAbRFkK_gcPkA.png"
        data-srcset="https://cdn-images-1.medium.com/max/800/1*CZm2Gzk1ChAbRFkK_gcPkA.png, https://cdn-images-1.medium.com/max/800/1*CZm2Gzk1ChAbRFkK_gcPkA.png 1.5x, https://cdn-images-1.medium.com/max/800/1*CZm2Gzk1ChAbRFkK_gcPkA.png 2x"
        data-sizes="auto"
        alt="https://cdn-images-1.medium.com/max/800/1*CZm2Gzk1ChAbRFkK_gcPkA.png"
        title="https://cdn-images-1.medium.com/max/800/1*CZm2Gzk1ChAbRFkK_gcPkA.png" /></p>
<p>I have created 2 more modules except from my current Android app module. I named my modules Browser since they I will basically navigate through app fragments.</p>
<p>Let’s start with the easy one: Create the desired annotation:</p>
<p>There are 2 important things here: The <code>@Target</code> which does the check if I have annotated my desired component, in my case a <code>CLASS</code> . If I annotate a method or a filed it will show an error, and the <code>@Retention</code> <em>which determines how an annotation is stored in binary output</em> (from Kotlin documentation). There are 3 kinds of <code>AnnotationRetention</code> s:</p>
<p><img
        class="lazyload"
        src="/coroutinedispatcher/svg/loading.min.svg"
        data-src="https://cdn-images-1.medium.com/max/800/1*k0uhVDP1LrBlQRKevAHVxA.png"
        data-srcset="https://cdn-images-1.medium.com/max/800/1*k0uhVDP1LrBlQRKevAHVxA.png, https://cdn-images-1.medium.com/max/800/1*k0uhVDP1LrBlQRKevAHVxA.png 1.5x, https://cdn-images-1.medium.com/max/800/1*k0uhVDP1LrBlQRKevAHVxA.png 2x"
        data-sizes="auto"
        alt="https://cdn-images-1.medium.com/max/800/1*k0uhVDP1LrBlQRKevAHVxA.png"
        title="https://cdn-images-1.medium.com/max/800/1*k0uhVDP1LrBlQRKevAHVxA.png" /></p>
<p>For the moment, I’m just letting it to source because I don’t need any of those other options.</p>
<p>Go to the <code>browser_compiler</code> and open its <code>build.gradle</code> to import these libraries:</p>
<p>We will explain other dependencies later. For the moment just notice importing the above module in order to handle that Annotation in the compiler module.</p>
<blockquote>
<p>Note: don’t forget to add the <code>apply plugin: ‘kotlin-kapt’</code> ,otherwise, forget about a successful build.</p>
</blockquote>
<p>Create a class and extend <code>AbstractProcessor</code> (overriding the methods of course). Since I am using <a href="https://github.com/Takhion/kotlin-metadata" target="_blank" rel="noopener noreffer">kotlin metadata library</a>, I am extending the <code>KotlinAbstractProcessor</code> but there is no difference between them, except from accessing some fields directly on this case.</p>
<p>This is why we imported the other module here, to access the annotation.</p>
<p><strong>Work:</strong></p>
<p>The work will happen in the <code>process</code> method. This is where the magic happens:</p>
<p>This is where I am talking to the Kotlin compiler and telling it that if there is any thing annotated with <code>@BindFragment</code> annotation apart from a class, show some error message.</p>
<p>Our <code>elementUtils.getPackageOf(annotatedElement).toString()</code> will just provide us the annotated class package name, while the <code>annotatedElement.simpleName().toString()</code> will just provide us the annotated class name. Now let’s jump to the <code>startClassGeneration</code> method. I am using the <a href="https://github.com/square/kotlinpoet" target="_blank" rel="noopener noreffer">KotlinPoet</a> library to generate kotlin code on the compile time, but it is not mandatory, you can also type simple strings as long as it is correctly used without and without compile errors. This is the code:</p>
<p>You can read the documentation on what is doing one and what is doing the other.</p>
<p>Details are important:</p>
<p>We <strong>must</strong> annotate this generator class with the <code>@AutoService(Processor::class)</code> . It just creates a registration file for this custom processor. Not providing it will force you to include your processor manually in the <code>META-INF</code> directory. That way it can be accessed through all the project.</p>
<p>Full processor file:</p>
<p><strong>The moment of truth:</strong></p>
<p>Go to your <code>build.gradle</code> module app and import both your modules, the <code>browser</code> module as an implementation and the <code>browser_compiler</code> as the processor using <code>kapt</code>. Note to include <code>kotlin-kapt</code> here also.</p>
<p>Annotate your Fragments with your created annotation:</p>
<p>Annotate your second fragment, which you will navigate after a button click in the first fragment:</p>
<p>Hit BUILD on your IDE and go to main activity to open the <code>FirstFragment</code></p>
<p>And the <code>FirstFragment</code> , on the button click will have this code:</p>
<p>Done!</p>
<p><img
        class="lazyload"
        src="/coroutinedispatcher/svg/loading.min.svg"
        data-src="https://cdn-images-1.medium.com/max/800/1*Jp2AG9J0ou_8KarZmlPx1w.gif"
        data-srcset="https://cdn-images-1.medium.com/max/800/1*Jp2AG9J0ou_8KarZmlPx1w.gif, https://cdn-images-1.medium.com/max/800/1*Jp2AG9J0ou_8KarZmlPx1w.gif 1.5x, https://cdn-images-1.medium.com/max/800/1*Jp2AG9J0ou_8KarZmlPx1w.gif 2x"
        data-sizes="auto"
        alt="https://cdn-images-1.medium.com/max/800/1*Jp2AG9J0ou_8KarZmlPx1w.gif"
        title="https://cdn-images-1.medium.com/max/800/1*Jp2AG9J0ou_8KarZmlPx1w.gif" /></p>
<p><strong>Conclusion:</strong></p>
<p>There is plenty to learn on generating code at compile time and this includes me too. I want to start creating a real library, once I feel confident on this.</p>
<p>Happy processing!</p>
<p>By <a href="https://medium.com/@stavro96" target="_blank" rel="noopener noreffer">Stavro Xhardha</a> on <a href="https://medium.com/p/b0e23dd9a3e2" target="_blank" rel="noopener noreffer">May 31, 2019</a>.<br>
<a href="https://medium.com/@stavro96/annotation-processor-say-less-mean-more-b0e23dd9a3e2" target="_blank" rel="noopener noreffer">Canonical link</a><br>
Exported from <a href="https://medium.com/" target="_blank" rel="noopener noreffer">Medium</a> on June 19, 2019.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2019-06-19</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/coroutinedispatcher/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/coroutinedispatcher/posts/kotlin-coroutines-non-confusing-one/" class="prev" rel="prev" title="Kotlin Coroutines, the non-confusing one "><i class="fas fa-angle-left fa-fw"></i>Kotlin Coroutines, the non-confusing one </a>
            <a href="/coroutinedispatcher/posts/usage-of-viewmodelscope/" class="next" rel="next" title="Usage of the ViewModelScope">Usage of the ViewModelScope<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.73.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/about/" target="_blank">Stavro Xhardha</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/coroutinedispatcher/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/coroutinedispatcher/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/coroutinedispatcher/lib/algoliasearch/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="/coroutinedispatcher/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/coroutinedispatcher/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":100},"comment":{},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.en","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/coroutinedispatcher/js/theme.min.js"></script></body>
</html>
